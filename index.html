<!DOCTYPE html>
<html lang="tg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–°–û–ù –°–ê–í–î–û v6.3 (Full Version)</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --main: #007bff; --bg: #f4f7f6; --gold: #ffc107; --red: #dc3545; --green: #28a745; --dark: #333; --gray: #777; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); padding-bottom: 90px; color: var(--dark); overflow-x: hidden; }
        .header { background: var(--main); color: white; padding: 12px 15px; position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .mini-logo { width: 45px; height: 45px; background: white; color: var(--main); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        .search-box { flex: 1; }
        .search-box input { width: 100%; padding: 10px 15px; border-radius: 20px; border: none; outline: none; box-sizing: border-box; }
        .cats { display: flex; gap: 8px; overflow-x: auto; padding: 10px 15px; scrollbar-width: none; background: white; border-bottom: 1px solid #eee; }
        .cat-btn { background: #eee; padding: 8px 15px; border-radius: 20px; font-size: 13px; white-space: nowrap; border: none; cursor: pointer; transition: 0.3s; }
        .cat-btn.active { background: var(--main); color: white; }
        
        /* –°—Ç–∏–ª–∏ VIP –≤–∞ –ö–∞—Ä—Ç“≥–æ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; border: 1px solid #eee; }
        .card.vip { border: 2px solid var(--gold); }
        .vip-badge { position: absolute; top: 5px; left: 5px; background: var(--gold); color: black; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 5px; z-index: 10; }
        .card img { width: 100%; height: 130px; object-fit: cover; }
        .card-body { padding: 10px; }
        .price { color: var(--red); font-weight: bold; font-size: 16px; }
        .title { font-size: 12px; height: 34px; overflow: hidden; margin: 5px 0; color: #444; font-weight: 500; }
        
        /* –ú–æ–¥–∞–ª –≤–∞ –ù–∞–≤–∏–≥–∞—Ç—Å–∏—è */
        #ad-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 5000; overflow-y: auto; flex-direction: column; }
        .slider-container { width: 100%; height: 350px; position: relative; background: #000; }
        .slider-track img { width: 100%; height: 100%; object-fit: contain; }
        .modal-body { padding: 20px; flex: 1; }
        .spec-item { background: #f8f9fa; padding: 10px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 14px; }
        
        .input-style { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; }
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; padding: 10px 0; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: var(--gray); cursor: pointer; border: none; background: none; }
        .nav-item b { font-size: 20px; display: block; }
        
        .btn-call { background: var(--main); color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: bold; display: block; text-align: center; text-decoration: none; margin-top: 20px; }
        .btn-red { background: var(--red); color: white; border: none; padding: 10px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 10px; }
        .btn-vip { background: var(--gold); color: black; border: none; padding: 10px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 5px; }
        
        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 7000; align-items: center; justify-content: center; flex-direction: column; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div style="border: 4px solid #f3f3f3; border-top: 4px solid var(--main); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
    <p>–õ—É—Ç—Ñ–∞–Ω, –º—É–Ω—Ç–∞–∑–∏—Ä —à–∞–≤–µ–¥...</p>
</div>

<div id="auth-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:6000; display:flex; align-items:center; justify-content:center;">
    <div style="width:80%; text-align:center;">
        <h2 style="color:var(--main);">OSON SAVDO</h2>
        <input type="number" id="regPhone" class="input-style" placeholder="931234567">
        <button onclick="auth.login()" class="btn-call">–ì–ò–†–ò–§–¢–ê–ù–ò –ö–û–î</button>
    </div>
</div>

<div id="main-content" style="display:none;">
    <div class="header">
        <div class="mini-logo">–û–°</div>
        <div class="search-box"><input type="text" placeholder="“∂—É—Å—Ç—É“∑”Ø..." oninput="app.search(this.value)"></div>
    </div>

    <div id="home-view">
        <div class="cats" id="cat-nav">
            <div class="cat-btn active" onclick="app.filter('“≤–∞–º–∞', this)">“≤–∞–º–∞</div>
            <div class="cat-btn" onclick="app.filter('–¢–µ–ª–µ—Ñ–æ–Ω', this)">üì± –¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div class="cat-btn" onclick="app.filter('–ú–æ—à–∏–Ω', this)">üöó –ú–æ—à–∏–Ω</div>
            <div class="cat-btn" onclick="app.filter('–•–æ–Ω–∞', this)">üè† –•–æ–Ω–∞</div>
            <div class="cat-btn" onclick="app.filter('–ò“∑–æ—Ä–∞', this)">üîë –ò“∑–æ—Ä–∞</div>
            <div class="cat-btn" onclick="app.filter('–£—Å—Ç–æ', this)">üõ†Ô∏è –£—Å—Ç–æ</div>
            <div class="cat-btn" onclick="app.filter('–±–∞—Ä–Ω–æ–º–∞—Å–æ–∑', this)">üíª –ë–∞—Ä–Ω–æ–º–∞—Å–æ–∑</div>
            <div class="cat-btn" onclick="app.filter('–ª–∏–±–æ—Å', this)">üëï –õ–∏–±–æ—Å</div>
            <div class="cat-btn" onclick="app.filter('–û–ø—Ç–æ–º', this)">üì¶ –û–ø—Ç–æ–º</div>
        </div>
    </div>

    <div class="container"><div id="feed"></div></div>

    <div class="nav">
        <button class="nav-item" onclick="app.goHome()"><b>üè†</b>–ê—Å–æ—Å”£</button>
        <button class="nav-item" onclick="app.showAdd()"><b>‚ûï</b>–≠—ä–ª–æ–Ω</button>
        <button class="nav-item" onclick="app.showMyAds()"><b>üë§</b>–ü—Ä–æ—Ñ–∏–ª</button>
    </div>
</div>

<div id="ad-modal">
    <div class="slider-container">
        <div class="slider-track" id="slider-track"></div>
        <div onclick="app.closeModal()" style="position:fixed; top:20px; right:20px; background:rgba(0,0,0,0.5); color:white; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:6000;">‚úï</div>
    </div>
    <div class="modal-body">
        <h2 id="m-price" style="color:var(--red); margin:0;"></h2>
        <h3 id="m-title" style="margin: 10px 0;"></h3>
        <div id="m-extra"></div>
        <p id="m-desc" style="color:var(--gray); line-height:1.5;"></p>
        <a id="m-call" href="#" class="btn-call">üìû –ó–ê–ù–ì –ó–ê–î–ê–ù</a>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCqq4c90VGUjKZc6bo6cQ3abOEWrz2mB4w",
  authDomain: "oson-savdo-4384f.firebaseapp.com",
  databaseURL: "https://oson-savdo-4384f-default-rtdb.firebaseio.com",
  projectId: "oson-savdo-4384f",
  storageBucket: "oson-savdo-4384f.firebasestorage.app",
  appId: "1:114437910664:web:4c622f0cbf8a913e426f3d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const auth = {
    user: localStorage.getItem('os_user'),
    adminPhone: "900000000", // –†–∞“õ–∞–º–∏ –∞–¥–º–∏–Ω—Ä–æ –∏–Ω“∑–æ –≥—É–∑–æ—Ä–µ–¥
    login() {
        const p = document.getElementById('regPhone').value;
        if(p.length >= 9) { localStorage.setItem('os_user', p); location.reload(); }
    },
    check() { if(this.user) { document.getElementById('auth-overlay').style.display='none'; document.getElementById('main-content').style.display='block'; } },
    isAdmin() { return this.user === this.adminPhone; }
};

const app = {
    ads: [],
    currentImg: "",
    
    init() {
        db.ref('ads').on('value', (s) => {
            const d = s.val();
            let list = d ? Object.values(d) : [];
            this.ads = list.sort((a, b) => (b.isVip || 0) - (a.isVip || 0) || b.id - a.id);
            this.render(this.ads);
        });
    },

    render(data) {
        const feed = document.getElementById('feed');
        feed.className = "grid";
        feed.innerHTML = data.map(a => `
            <div class="card ${a.isVip ? 'vip' : ''}" onclick="app.viewAd('${a.id}')">
                ${a.isVip ? '<div class="vip-badge">VIP</div>' : ''}
                <img src="${a.img}">
                <div class="card-body">
                    <div class="price">${Number(a.price).toLocaleString()} —Å–º–Ω</div>
                    <div class="title">${a.title}</div>
                </div>
            </div>`).join('');
    },

    handleImg(i) {
        const file = i.files[0];
        if(!file) return;
        document.getElementById('loading-overlay').style.display = 'flex';
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let w = img.width, h = img.height, max = 800;
                if(w > h) { if(w > max) { h *= max/w; w = max; } } else { if(h > max) { w *= max/h; h = max; } }
                canvas.width = w; canvas.height = h;
                canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                this.currentImg = canvas.toDataURL('image/jpeg', 0.7);
                document.getElementById('img-prev').innerHTML = `<img src="${this.currentImg}" style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`;
                document.getElementById('loading-overlay').style.display = 'none';
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    },

    showAdd() {
        document.getElementById('home-view').style.display = 'none';
        const feed = document.getElementById('feed');
        feed.className = "";
        feed.innerHTML = `
            <div style="background:white; padding:20px; border-radius:15px;">
                <h3>–≠—ä–ª–æ–Ω–∏ –Ω–∞–≤</h3>
                <div onclick="document.getElementById('fIn').click()" id="img-prev" style="background:#eee; height:150px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:15px; border:2px dashed #ccc;">üì∑ –ê–∫—Å</div>
                <input type="file" id="fIn" hidden accept="image/*" onchange="app.handleImg(this)">
                <select id="fCat" class="input-style" onchange="app.renderExtraForm(this.value)">
                    <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥</option>
                    <option>–¢–µ–ª–µ—Ñ–æ–Ω</option><option>–ú–æ—à–∏–Ω</option><option>–•–æ–Ω–∞</option>
                    <option>–ò“∑–æ—Ä–∞</option><option>–£—Å—Ç–æ</option><option>–õ–∏–±–æ—Å</option>
                    <option>–±–∞—Ä–Ω–æ–º–∞—Å–æ–∑</option><option>–û–ø—Ç–æ–º</option>
                </select>
                <div id="extra-inputs"></div>
                <input type="text" id="fT" placeholder="–ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç" class="input-style">
                <input type="number" id="fP" placeholder="–ù–∞—Ä—Ö (—Å–º–Ω)" class="input-style">
                <textarea id="fD" placeholder="–¢–∞–≤—Å–∏—Ñ–∏ –ø—É—Ä—Ä–∞" class="input-style" style="height:100px"></textarea>
                <button onclick="app.saveAd()" class="btn-call">–ù–ê–®–† –ö–ê–†–î–ê–ù</button>
            </div>`;
    },

    renderExtraForm(cat) {
        const container = document.getElementById('extra-inputs');
        let html = '';
        if(cat === '–ú–æ—à–∏–Ω') html = '<input id="ex1" placeholder="–ú–∞—Ç–æ—Ä (–ª)" class="input-style"><input id="ex2" placeholder="–ü—Ä–æ–±–µ–≥ (–∫–º)" class="input-style"><input id="ex3" placeholder="–°–æ–ª" class="input-style">';
        if(cat === '–¢–µ–ª–µ—Ñ–æ–Ω') html = '<input id="ex1" placeholder="–•–æ—Ç–∏—Ä–∞ (–ì–ë)" class="input-style">';
        if(cat === '–•–æ–Ω–∞') html = '<input id="ex1" placeholder="–ú–∞—Å–æ“≥–∞—Ç (–º¬≤)" class="input-style">';
        if(cat === '–±–∞—Ä–Ω–æ–º–∞—Å–æ–∑') html = '<input id="ex1" placeholder="–¢–∞“∑—Ä–∏–±–∞ (—Å–æ–ª)" class="input-style"><input id="ex2" placeholder="Stack" class="input-style">';
        container.innerHTML = html;
    },

    saveAd() {
        const t = document.getElementById('fT').value, p = document.getElementById('fP').value, c = document.getElementById('fCat').value;
        if(!t || !p || !this.currentImg) return alert("–ü—É—Ä –∫—É–Ω–µ–¥!");
        document.getElementById('loading-overlay').style.display = 'flex';
        const id = Date.now();
        const extra = { ex1: document.getElementById('ex1')?.value || '', ex2: document.getElementById('ex2')?.value || '', ex3: document.getElementById('ex3')?.value || '' };
        db.ref('ads/'+id).set({id, title:t, price:p, cat:c, img:this.currentImg, desc:document.getElementById('fD').value, phone:auth.user, isVip:false, ...extra})
        .then(() => location.reload());
    },

    viewAd(id) {
        const ad = this.ads.find(a => a.id == id);
        document.getElementById('slider-track').innerHTML = `<img src="${ad.img}">`;
        document.getElementById('m-price').innerText = Number(ad.price).toLocaleString() + ' —Å–º–Ω';
        document.getElementById('m-title').innerText = ad.title;
        document.getElementById('m-desc').innerText = ad.desc || '';
        document.getElementById('m-call').href = 'tel:' + ad.phone;
        
        let extraHtml = '';
        if(ad.cat === '–ú–æ—à–∏–Ω') extraHtml = `<div class="spec-item"><span>–ú–∞—Ç–æ—Ä</span><b>${ad.ex1} –ª</b></div><div class="spec-item"><span>–ü—Ä–æ–±–µ–≥</span><b>${ad.ex2} –∫–º</b></div><div class="spec-item"><span>–°–æ–ª</span><b>${ad.ex3}</b></div>`;
        if(ad.cat === '–¢–µ–ª–µ—Ñ–æ–Ω') extraHtml = `<div class="spec-item"><span>–•–æ—Ç–∏—Ä–∞</span><b>${ad.ex1} –ì–ë</b></div>`;
        document.getElementById('m-extra').innerHTML = extraHtml;
        
        document.getElementById('ad-modal').style.display = 'flex';
    },

    showMyAds() {
        document.getElementById('home-view').style.display = 'none';
        const feed = document.getElementById('feed');
        feed.className = "";
        const myAds = this.ads.filter(a => a.phone === auth.user);
        const adminBtn = auth.isAdmin() ? `<button onclick="app.showAdminPanel()" class="btn-vip">‚öôÔ∏è –ü–ê–ù–ï–õ–ò –ê–î–ú–ò–ù</button>` : '';
        feed.innerHTML = `
            <div style="background:white; padding:20px; border-radius:15px; text-align:center; margin-bottom:15px;">
                <h3>–ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–Ω</h3>
                <p>üìû +992 ${auth.user}</p>
                ${adminBtn}
                <button onclick="localStorage.clear(); location.reload();" class="btn-red">–ë–ê–†–û–ú–ê–î</button>
            </div>
            <h4>–≠—ä–ª–æ–Ω“≥–æ–∏ –º–∞–Ω:</h4>
            <div class="grid">${myAds.map(a => `<div class="card"><img src="${a.img}"><div class="card-body"><b>${a.price} —Å–º–Ω</b><div>${a.title}</div><button onclick="app.deleteAd('${a.id}')" style="border:none; color:red; background:none;">üóëÔ∏è –ù–µ—Å—Ç –∫–∞—Ä–¥–∞–Ω</button></div></div>`).join('')}</div>`;
    },

    showAdminPanel() {
        document.getElementById('home-view').style.display = 'none';
        const feed = document.getElementById('feed');
        feed.className = "";
        feed.innerHTML = `<div style="padding:20px; background:#333; color:white; border-radius:15px; margin-bottom:15px;"><h3>–ü–∞–Ω–µ–ª–∏ –ê–¥–º–∏–Ω</h3><button onclick="app.goHome()" class="btn-call">–ë–ê –ü–ê–°</button></div><div class="grid">${this.ads.map(a => `
            <div class="card ${a.isVip ? 'vip' : ''}">
                <img src="${a.img}"><div class="card-body"><b>${a.price} —Å–º–Ω</b>
                <button onclick="app.toggleVip('${a.id}', ${!a.isVip})" class="btn-vip">${a.isVip ? '‚ùå –ù–ï–°–¢ –ö–ê–†–î–ê–ù–ò VIP' : '‚≠ê VIP –ö–ê–†–î–ê–ù'}</button>
                <button onclick="app.deleteAd('${a.id}')" class="btn-red">üóëÔ∏è –ù–ï–°–¢ –ö–ê–†–î–ê–ù</button>
            </div></div>`).join('')}</div>`;
    },

    toggleVip(id, st) { db.ref('ads/'+id).update({isVip: st}).then(() => alert("VIP –∏–≤–∞–∑ —à—É–¥")); },
    deleteAd(id) { if(confirm("–ù–µ—Å—Ç –∫—É–Ω–µ–º?")) db.ref('ads/'+id).remove().then(() => location.reload()); },
    closeModal() { document.getElementById('ad-modal').style.display = 'none'; },
    goHome() { location.reload(); },
    filter(cat, el) { 
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active')); 
        el.classList.add('active'); 
        this.render(cat === '“≤–∞–º–∞' ? this.ads : this.ads.filter(a => a.cat === cat)); 
    },
    search(q) { this.render(this.ads.filter(a => a.title.toLowerCase().includes(q.toLowerCase()))); }
};

auth.check();
app.init();
</script>
</body>
</html>
