<!DOCTYPE html>
<html lang="tg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–°–û–ù –°–ê–í–î–û v5.1 - Online</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --main: #007bff; --bg: #f4f7f6; --gold: #ffd700; --red: #dc3545; --green: #28a745; --dark: #333; --gray: #777; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); padding-bottom: 90px; color: var(--dark); overflow-x: hidden; }
        .header { background: var(--main); color: white; padding: 12px 15px; position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .mini-logo { width: 45px; height: 45px; background: #007bff; color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; box-shadow: 0 4px 10px rgba(0,123,255,0.3); }
        .search-box { flex: 1; }
        .search-box input { width: 100%; padding: 10px 15px; border-radius: 20px; border: none; outline: none; box-sizing: border-box; }
        .cats { display: flex; gap: 8px; overflow-x: auto; padding: 10px 15px; scrollbar-width: none; background: white; border-bottom: 1px solid #eee; }
        .cat-btn { background: #eee; padding: 8px 15px; border-radius: 20px; font-size: 13px; white-space: nowrap; border: none; cursor: pointer; transition: 0.3s; }
        .cat-btn.active { background: var(--main); color: white; }
        .welcome-msg { padding: 15px 15px 5px; font-size: 18px; font-weight: bold; }
        .vip-section { padding: 15px; background: #fffbe6; border-bottom: 2px solid var(--gold); margin-bottom: 10px; }
        .vip-header { font-weight: bold; color: #d35400; margin-bottom: 10px; font-size: 13px; display: flex; align-items: center; gap: 5px; }
        .vip-scroll { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; }
        .vip-card { min-width: 120px; background: white; border-radius: 12px; overflow: hidden; border: 1px solid var(--gold); position: relative; }
        .vip-card img { width: 100%; height: 90px; object-fit: cover; }
        .vip-card p { font-size: 11px; padding: 6px; margin: 0; font-weight: bold; text-align: center; }
        .container { padding: 10px 15px; max-width: 600px; margin: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; border: 1px solid #eee; }
        .card img { width: 100%; height: 130px; object-fit: cover; }
        .card-body { padding: 10px; }
        .price { color: var(--red); font-weight: bold; font-size: 16px; }
        .title { font-size: 12px; height: 34px; overflow: hidden; margin: 5px 0; color: #444; font-weight: 500; }
        .sold-badge { position: absolute; top: 40px; left: 0; width: 100%; background: rgba(220, 53, 69, 0.8); color: white; text-align: center; padding: 5px 0; font-weight: bold; transform: rotate(-15deg); font-size: 12px; z-index: 2; }
        .vip-star { position: absolute; top: 5px; left: 5px; background: var(--gold); color: black; font-size: 9px; padding: 2px 6px; border-radius: 5px; font-weight: bold; z-index: 2; }
        .like-btn { position: absolute; top: 8px; right: 8px; background: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: none; cursor: pointer; z-index: 3; }
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; padding: 10px 0; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: var(--gray); cursor: pointer; border: none; background: none; outline: none; }
        .nav-item b { font-size: 20px; display: block; margin-bottom: 2px; }
        #ad-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 5000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 400px; border-radius: 20px; overflow: hidden; position: relative; }
        .modal-body { padding: 20px; }
        .btn-call { background: var(--main); color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: bold; display: block; text-align: center; text-decoration: none; margin-bottom: 10px; cursor: pointer; }
        .btn-wa { background: var(--green); color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: bold; display: block; text-align: center; text-decoration: none; cursor: pointer; }
        .centered-form { display: flex; flex-direction: column; justify-content: center; min-height: calc(100vh - 160px); max-width: 400px; margin: 0 auto; }
        .btn-logout { background: var(--red); color: white; border: none; padding: 10px; border-radius: 10px; width: 100%; font-weight: bold; margin-bottom: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:6000; display:flex; align-items:center; justify-content:center;">
    <div style="width:80%; text-align:center;">
        <h2 style="color:var(--main); margin-bottom:30px; font-weight: bold; letter-spacing: 1px;">OSON SAVDO</h2>
        <div class="mini-logo" style="margin: 0 auto 15px auto; width: 85px; height: 85px; font-size: 38px; border-radius: 20px;">–û–°</div>
        <h1 style="color:var(--main); margin-bottom:10px;">–•—É—à –æ–º–∞–¥–µ–¥!</h1>
        <input type="number" id="regPhone" style="width:100%; padding:15px; border-radius:15px; border:2px solid #eee; margin-bottom:15px; outline:none;" placeholder="931234567">
        <button onclick="auth.login()" style="background:var(--main); color:white; border:none; padding:15px; border-radius:15px; width:100%; font-weight:bold; cursor:pointer;">–ì–ò–†–ò–§–¢–ê–ù–ò –ö–û–î</button>
    </div>
</div>

<div id="main-content" style="display:none;">
    <div class="header">
        <div class="mini-logo">–û–°</div>
        <div class="search-box">
            <input type="text" placeholder="“∂—É—Å—Ç—É“∑”Ø–∏ –º–∞“≥—Å—É–ª–æ—Ç..." oninput="app.search(this.value)">
        </div>
    </div>

    <div id="home-view">
        <div class="welcome-msg" id="greeting">–°–∞–ª–æ–º!</div>
        <div id="vip-area" class="vip-section" style="display:none;">
            <div class="vip-header">‚≠ê VIP –¢–ê–ö–õ–ò–§“≤–û</div>
            <div class="vip-scroll" id="vip-track"></div>
        </div>
        <div class="cats" id="cat-nav">
            <div class="cat-btn active" onclick="app.filter('“≤–∞–º–∞', this)">“≤–∞–º–∞</div>
            <div class="cat-btn" onclick="app.filter('–¢–µ–ª–µ—Ñ–æ–Ω', this)">üì± –¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div class="cat-btn" onclick="app.filter('–ú–æ—à–∏–Ω', this)">üöó –ú–æ—à–∏–Ω</div>
            <div class="cat-btn" onclick="app.filter('–•–æ–Ω–∞', this)">üè† –•–æ–Ω–∞</div>
            <div class="cat-btn" onclick="app.filter('–ò“∑–æ—Ä–∞', this)">üîë –ò“∑–æ—Ä–∞</div>
            <div class="cat-btn" onclick="app.filter('–ù–æ—É—Ç–±—É–∫', this)">üíª –ù–æ—É—Ç–±—É–∫</div>
            <div class="cat-btn" onclick="app.filter('–£—Å—Ç–æ', this)">üõ†Ô∏è –£—Å—Ç–æ</div>
            <div class="cat-btn" onclick="app.filter('–õ–∏–±–æ—Å', this)">üëï –õ–∏–±–æ—Å</div>
            <div class="cat-btn" onclick="app.filter('–û–ø—Ç–æ–º', this)">üì¶ –û–ø—Ç–æ–º</div>
        </div>
    </div>

    <div class="container">
        <div id="profile-tools" style="display:none;">
             <button class="btn-logout" onclick="auth.logout()">üî¥ –ë–ê–†–û–ú–ê–î –ê–ó –ü–†–û–§–ò–õ</button>
        </div>
        <div id="feed"></div>
    </div>

    <div class="nav">
        <button class="nav-item" onclick="app.goHome()"><b>üè†</b>–ê—Å–æ—Å”£</button>
        <button class="nav-item" onclick="app.showAdd()"><b>‚ûï</b>–≠—ä–ª–æ–Ω</button>
        <a href="https://wa.me/992000000000" target="_blank" class="nav-item"><b>üí¨</b>–ß–∞—Ç</a>
        <button class="nav-item" onclick="app.showFavs()"><b>‚ù§Ô∏è</b>–î”Ø—Å—Ç–¥–æ—à—Ç–∞</button>
        <button class="nav-item" onclick="app.showMyAds()"><b>üë§</b>–ü—Ä–æ—Ñ–∏–ª</button>
    </div>
</div>

<div id="ad-modal">
    <div class="modal-content">
        <div onclick="app.closeModal()" style="position:absolute; top:15px; right:15px; background:rgba(0,0,0,0.5); color:white; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10;">‚úï</div>
        <img src="" id="m-img" style="width:100%; height:250px; object-fit:cover;">
        <div class="modal-body">
            <h2 id="m-price" style="color:var(--red); margin:0;"></h2>
            <h3 id="m-title" style="margin: 10px 0;"></h3>
            <a id="m-call" href="#" class="btn-call">üìû –ó–ê–ù–ì –ó–ê–î–ê–ù</a>
            <a id="m-wa" href="#" target="_blank" class="btn-wa">üí¨ WHATSAPP</a>
        </div>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCqq4c90VGUjKZc6bo6cQ3abOEWrz2mB4w",
  authDomain: "oson-savdo-4384f.firebaseapp.com",
  databaseURL: "https://oson-savdo-4384f-default-rtdb.firebaseio.com",
  projectId: "oson-savdo-4384f",
  storageBucket: "oson-savdo-4384f.firebasestorage.app",
  messagingSenderId: "114437910664",
  appId: "1:114437910664:web:4c622f0cbf8a913e426f3d",
  measurementId: "G-DFY3WY3JZ5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const auth = {
    user: localStorage.getItem('os_user'),
    login() {
        const p = document.getElementById('regPhone').value;
        const tjRegexp = /^(90|91|92|93|98|50|55|77|88|20|00|11)\d{7}$|^00\d{2,7}$/;
        if(tjRegexp.test(p)) { localStorage.setItem('os_user', p); location.reload(); }
        else alert("–†–∞“õ–∞–º–∏ –Ω–æ–¥—É—Ä—É—Å—Ç!");
    },
    logout() { if(confirm("–ë–∞—Ä–æ–º–∞–¥–∞–Ω?")) { localStorage.removeItem('os_user'); location.reload(); } },
    check() { if(this.user) { document.getElementById('auth-overlay').style.display = 'none'; document.getElementById('main-content').style.display = 'block'; this.setGreeting(); } },
    setGreeting() { const h = new Date().getHours(); document.getElementById('greeting').innerText = h < 12 ? "‚òÄÔ∏è –°—É–±“≥ –±–∞ —Ö–∞–π—Ä!" : h < 18 ? "üå§Ô∏è –†”Ø–∑ –±–∞ —Ö–∞–π—Ä!" : "üåô –®–æ–º–∏ –±–∞ —Ö–∞–π—Ä!"; }
};

const app = {
    ads: [],
    favs: JSON.parse(localStorage.getItem('os_favs')) || [],
    currentImg: "",
    adminPass: "7777",
    currentView: 'home',

    init() {
        db.ref('ads').on('value', (s) => {
            const d = s.val();
            this.ads = d ? Object.values(d) : [];
            this.render(this.ads, this.currentView);
        });
    },

    render(data, mode = 'home') {
        this.currentView = mode;
        const feed = document.getElementById('feed');
        const vipTrack = document.getElementById('vip-track');
        const vipArea = document.getElementById('vip-area');
        const pTools = document.getElementById('profile-tools');
        
        feed.className = (mode === 'home' || mode === 'fav' || mode === 'admin') ? "grid" : "";
        pTools.style.display = (mode === 'profile' || mode === 'admin') ? 'block' : 'none';
        
        const sorted = [...data].sort((a,b) => b.id - a.id);

        if(mode === 'home') {
            document.getElementById('home-view').style.display = 'block';
            const vips = this.ads.filter(a => a.isVip);
            if(vips.length > 0) {
                vipArea.style.display = 'block';
                vipTrack.innerHTML = vips.map(v => `<div class="vip-card" onclick="app.viewAd(${v.id})"><img src="${v.img}"><p>${Number(v.price).toLocaleString()} —Å.</p></div>`).join('');
            } else vipArea.style.display = 'none';
        } else document.getElementById('home-view').style.display = 'none';

        if(mode !== 'profile') feed.innerHTML = sorted.map(a => this.adCardTemplate(a, mode)).join('');
    },

    adCardTemplate(a, mode) {
        return `
            <div class="card" onclick="app.viewAd(${a.id})">
                ${a.isSold ? '<div class="sold-badge">–§–£–†”Æ–•–¢–ê –®–£–î</div>' : ''}
                ${a.isVip ? '<span class="vip-star">‚òÖ VIP</span>' : ''}
                <button class="like-btn" onclick="event.stopPropagation(); app.toggleFav(${a.id})">${this.favs.includes(a.id)?'‚ù§Ô∏è':'ü§ç'}</button>
                <img src="${a.img}">
                <div class="card-body">
                    <div class="price">${Number(a.price).toLocaleString()} —Å–º–Ω.</div>
                    <div class="title">${a.title}</div>
                    ${mode === 'admin' ? `
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <button onclick="event.stopPropagation(); app.toggleSold(${a.id})">‚úÖ</button>
                            <button onclick="event.stopPropagation(); app.toggleVip(${a.id})">‚≠ê</button>
                            <button onclick="event.stopPropagation(); app.deleteAd(${a.id})">üóëÔ∏è</button>
                        </div>` : ''}
                </div>
            </div>`;
    },

    showMyAds() {
        const myAds = this.ads.filter(a => a.phone === auth.user);
        this.currentView = 'profile';
        document.getElementById('home-view').style.display = 'none';
        document.getElementById('profile-tools').style.display = 'block';
        const feed = document.getElementById('feed');
        feed.className = "";
        feed.innerHTML = `
            <div style="background:white; padding:20px; border-radius:15px; text-align:center; margin-bottom:15px;">
                <div style="width:60px; height:60px; background:var(--main); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-size:24px;">üë§</div>
                <h3>–ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–Ω</h3>
                <p>üìû +992 ${auth.user}</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                    <button onclick="app.shareApp()" style="background:#e8f0fe; border:none; padding:10px; border-radius:10px; font-weight:bold; color:var(--main);">üîó –†–ê–í–û–ù –ö–ê–†–î–ê–ù</button>
                    <button onclick="app.editPhone()" style="background:#eee; border:none; padding:10px; border-radius:10px; font-weight:bold;">‚öôÔ∏è –ò–í–ê–ó–ò –†–ê“ö–ê–ú</button>
                </div>
                <button onclick="app.adminLogin()" style="opacity:0; margin-top:5px;">.</button>
            </div>
            <h4>–≠—ä–ª–æ–Ω“≥–æ–∏ –º–∞–Ω:</h4>
            <div class="grid">${myAds.map(a => this.adCardTemplate(a, 'my')).join('')}</div>`;
    },

    shareApp() {
        const text = "–û–°–û–ù –°–ê–í–î–û - –ë–µ“≥—Ç–∞—Ä–∏–Ω –±–∞—Ä–Ω–æ–º–∞ –±–∞—Ä–æ–∏ —Ö–∞—Ä–∏–¥—É —Ñ—É—Ä”Ø—à –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω!";
        const url = window.location.href;
        if (navigator.share) {
            navigator.share({ title: 'OSON SAVDO', text: text, url: url });
        } else {
            prompt("–ò—Å—Ç–∏–Ω–æ–¥—Ä–æ –Ω—É—Å—Ö–∞ –≥–∏—Ä–µ–¥:", url);
        }
    },

    editPhone() {
        const n = prompt("–†–∞“õ–∞–º–∏ –Ω–∞–≤—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥ (9 —Ä–∞“õ–∞–º):", auth.user);
        if(n && /^\d{9}$/.test(n)) {
            localStorage.setItem('os_user', n);
            alert("–†–∞“õ–∞–º –∏–≤–∞–∑ —à—É–¥!");
            location.reload();
        }
    },

    showAdd() {
        document.getElementById('home-view').style.display = 'none';
        const feed = document.getElementById('feed');
        feed.className = "centered-form";
        feed.innerHTML = `
            <div style="background:white; padding:20px; border-radius:15px;">
                <h3 style="text-align:center;">–≠—ä–ª–æ–Ω–∏ –Ω–∞–≤</h3>
                <div onclick="document.getElementById('fIn').click()" id="img-prev" style="background:#f0f2f5; height:180px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:15px; border: 2px dashed #ccc; cursor:pointer;">üì∑ –ê–∫—Å</div>
                <input type="file" id="fIn" hidden accept="image/*" onchange="app.handleImg(this)">
                <input type="text" id="fT" placeholder="–ù–æ–º–∏ –º–∞“≥—Å—É–ª–æ—Ç" style="width:100%; padding:14px; margin-bottom:12px; border:1px solid #ddd; border-radius:12px; box-sizing:border-box;">
                <input type="number" id="fP" placeholder="–ù–∞—Ä—Ö (—Å–º–Ω)" style="width:100%; padding:14px; margin-bottom:12px; border:1px solid #ddd; border-radius:12px; box-sizing:border-box;">
                <select id="fCat" style="width:100%; padding:14px; margin-bottom:20px; border:1px solid #ddd; border-radius:12px;">
                    <option>–¢–µ–ª–µ—Ñ–æ–Ω</option><option>–ú–æ—à–∏–Ω</option><option>–•–æ–Ω–∞</option><option>–ò“∑–æ—Ä–∞</option><option>–ù–æ—É—Ç–±—É–∫</option><option>–£—Å—Ç–æ</option><option>–õ–∏–±–æ—Å</option><option>–û–ø—Ç–æ–º</option>
                </select>
                <button onclick="app.saveAd()" class="btn-call" style="border:none;">–ë–û–† –ö–ê–†–î–ê–ù</button>
            </div>`;
    },

    saveAd() {
        const t = document.getElementById('fT').value, p = document.getElementById('fP').value, c = document.getElementById('fCat').value;
        if(!t || !p || !this.currentImg) return alert("–ü—É—Ä –∫—É–Ω–µ–¥!");
        const id = Date.now();
        db.ref('ads/'+id).set({id, title:t, price:p, cat:c, img:this.currentImg, phone:auth.user, isSold:false, isVip:false})
        .then(() => { alert("–ë–æ—Ä —à—É–¥!"); this.goHome(); });
    },

    handleImg(i) {
        if(i.files && i.files[0]) {
            const r = new FileReader();
            r.onload = (e) => { this.currentImg = e.target.result; document.getElementById('img-prev').innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`; };
            r.readAsDataURL(i.files[0]);
        }
    },

    toggleSold(id) { const ad = this.ads.find(a => a.id === id); if(ad) db.ref('ads/'+id).update({isSold: !ad.isSold}); },
    toggleVip(id) { const ad = this.ads.find(a => a.id === id); if(ad) db.ref('ads/'+id).update({isVip: !ad.isVip}); },
    deleteAd(id) { if(confirm("–ù–µ—Å—Ç –∫—É–Ω–µ–º?")) db.ref('ads/'+id).remove(); },
    toggleFav(id) { if(this.favs.includes(id)) this.favs = this.favs.filter(i => i !== id); else this.favs.push(id); localStorage.setItem('os_favs', JSON.stringify(this.favs)); this.render(this.ads, this.currentView); },
    viewAd(id) {
        const ad = this.ads.find(a => a.id === id); if(!ad) return;
        document.getElementById('m-img').src = ad.img;
        document.getElementById('m-price').innerText = Number(ad.price).toLocaleString() + ' —Å–º–Ω';
        document.getElementById('m-title').innerText = ad.title;
        document.getElementById('m-call').href = 'tel:' + ad.phone;
        document.getElementById('m-wa').href = `https://wa.me/992${ad.phone}`;
        document.getElementById('ad-modal').style.display = 'flex';
    },
    closeModal() { document.getElementById('ad-modal').style.display = 'none'; },
    goHome() { location.reload(); },
    showFavs() { this.render(this.ads.filter(a => this.favs.includes(a.id)), 'fav'); },
    filter(cat, el) { document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); this.render(cat === '“≤–∞–º–∞' ? this.ads : this.ads.filter(a => a.cat === cat)); },
    search(q) { this.render(this.ads.filter(a => a.title.toLowerCase().includes(q.toLowerCase())), this.currentView); },
    adminLogin() { let p = prompt("–ü–∞—Ä–æ–ª:"); if(p === this.adminPass) this.render(this.ads, 'admin'); }
};

auth.check();
app.init();
</script>
</body>
</html>
